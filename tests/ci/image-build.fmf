---
summary: Create an Edge VM with the Image Builder
environment:
  GUEST_ADDRESS: 192.168.100.50
  HTTPD_PATH: "/var/www/html"
  IMAGE_TYPE: rhel-edge-commit
  OS_VARIANT: rhel8-unknown
  BLUEPRINT_FILE: "tests/ci/files/blueprint.toml"
  NEPTUNE_SOURCE_FILE: "tests/ci/files/copr_neptune.toml"
  KS_FILE: "tests/ci/files/ks.cfg"
  NET_CONFIG: "tests/ci/files/integration-net.xml"
prepare:
  - name: Enable EPEL repo
    how: shell
    script: dnf install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
  - name: Install dependencies
    how: install
    package:
      - osbuild-composer
      - composer-cli
      - ansible
      - jq
      - httpd
      - qemu-kvm
      - libvirt-daemon-kvm
      - virt-install
      - wget
      - firewalld
  - name: Start service Firewalld
    how: shell
    script: systemctl start firewalld
  - name: Start service libvirtd
    how: shell
    script: systemctl start libvirtd
  - name: Start service httpd
    how: shell
    script: systemctl start httpd
discover:
  how: shell
  tests:
    - name: Setup
      test: bash tests/ci/setup.sh
    - name: Create commit
      test: bash tests/ci/create-commit.sh
    - name: Install VM
      test: bash tests/ci/install-vm.sh
    - name: test-vm
      test: bash tests/ci/test-vm.sh
execute:
  how: tmt
  framework: shell
finish:
  - name: clean-up
    how: shell
    script: bash tests/ci/clean_up.sh
